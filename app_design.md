# ビデオプレビューアプリケーション設計

## 1. データベース構造分析

### データベーススキーマ
- **videos テーブル**
  - video_id (TEXT): 動画の一意識別子（例: "GH012846"）
  - source_filepath (TEXT): 元の動画ファイルパス
  - duration_seconds (REAL): 動画の長さ（秒）
  - creation_time (TEXT): 作成日時
  - timecode_offset (TEXT): タイムコードオフセット
  - completed (BOOLEAN): 処理完了フラグ
  - last_update (TEXT): 最終更新日時

- **scenes テーブル**
  - id (INTEGER): 自動採番ID
  - video_id (TEXT): 関連する動画ID（videosテーブルの外部キー）
  - scene_id (INTEGER): シーン番号
  - time_in (REAL): 開始時間（秒）
  - time_out (REAL): 終了時間（秒）
  - transcript (TEXT): 文字起こし
  - description (TEXT): シーン説明
  - keyframe_path (TEXT): キーフレーム画像のパス
  - preview_path (TEXT): プレビュー動画のパス
  - duration (REAL): シーンの長さ（秒）

### ファイルパス形式
- キーフレームパス: `GH01xxxx_captures/scene_xxxx.jpg`
- プレビューパス: 同上（実際の動画ファイルはないが、パスは保持）

## 2. アプリケーション設計

### 機能要件
1. SQLiteデータベースからシーン情報を読み込む
2. シーンのサムネイル（キーフレーム）をグリッド表示
3. サムネイルをダブルクリックすると対応する動画をプレビュー再生
4. 動画の基本情報（タイトル、時間など）を表示
5. シーンの詳細情報（説明、文字起こしなど）を表示

### 技術スタック
- **言語**: Python 3
- **GUI**: PyQt5（多機能でクロスプラットフォーム対応）
- **データベース**: SQLite3
- **動画再生**: PyQt5のQMediaPlayerを使用

### アプリケーション構成

#### 1. メインウィンドウ
- メニューバー（ファイル操作、設定など）
- 動画選択コンボボックス
- サムネイルグリッドビュー
- 詳細情報パネル
- 動画プレーヤーパネル

#### 2. サムネイルビューアコンポーネント
- グリッドレイアウトでサムネイル表示
- 各サムネイルにシーン番号とタイムコードを表示
- ダブルクリックイベントハンドリング

#### 3. 動画プレーヤーコンポーネント
- 動画表示エリア
- 再生コントロール（再生、一時停止、停止）
- シークバー
- 音量コントロール

#### 4. 詳細情報パネル
- シーンの説明
- 文字起こしテキスト
- 時間情報（開始、終了、長さ）

#### 5. データベース接続モジュール
- SQLiteデータベースへの接続管理
- クエリ実行と結果処理
- データモデルクラス

## 3. ユーザーインターフェース設計

```
+----------------------------------------------------------------------+
|  [ファイル] [表示] [ヘルプ]                                           |
+----------------------------------------------------------------------+
|  動画選択: [GH012846 ▼]                                              |
+----------------------------------------------------------------------+
|                                                |                      |
|  +--------+  +--------+  +--------+           |                      |
|  | サムネ |  | サムネ |  | サムネ |           |                      |
|  | #1     |  | #2     |  | #3     |           |                      |
|  +--------+  +--------+  +--------+           |                      |
|                                                |    動画プレーヤー    |
|  +--------+  +--------+  +--------+           |                      |
|  | サムネ |  | サムネ |  | サムネ |           |                      |
|  | #4     |  | #5     |  | #6     |           |                      |
|  +--------+  +--------+  +--------+           |                      |
|                                                |                      |
+----------------------------------------------------------------------+
|  シーン情報:                                                          |
|  説明: バケットハットをかぶった男性が、日本の都市部、高架道路や...    |
|  文字起こし: おはようございます。今日は4月19日。土曜日ですね。       |
|  時間: 00:00:02:00 - 00:00:10:00 (8.0秒)                            |
+----------------------------------------------------------------------+
|  [再生] [一時停止] [停止]    [===========|=====]    [音量: ■■■□□]   |
+----------------------------------------------------------------------+
```

## 4. クラス設計

### MainWindow クラス
- アプリケーションのメインウィンドウ
- 各コンポーネントの配置と連携

### DatabaseManager クラス
- データベース接続の管理
- クエリの実行
- データの取得と変換

### ThumbnailGrid クラス
- サムネイル画像の表示
- グリッドレイアウト管理
- クリックイベント処理

### VideoPlayer クラス
- 動画再生機能
- コントロールUI
- 再生状態管理

### SceneInfo クラス
- シーン情報の表示
- テキスト整形

## 5. データフロー

1. アプリケーション起動時:
   - DatabaseManagerがSQLiteデータベースに接続
   - 利用可能な動画リストを取得してコンボボックスに表示

2. 動画選択時:
   - 選択された動画のシーン情報を取得
   - ThumbnailGridにサムネイル画像を表示

3. サムネイルダブルクリック時:
   - クリックされたシーンの情報を取得
   - SceneInfoに詳細情報を表示
   - VideoPlayerに対応する動画ファイルをロードして再生

4. 動画再生中:
   - 再生状態をUIに反映
   - シークバーの位置を更新

## 6. 実装計画

1. プロジェクト構造のセットアップ
2. DatabaseManagerの実装
3. ThumbnailGridコンポーネントの実装
4. VideoPlayerコンポーネントの実装
5. SceneInfoパネルの実装
6. MainWindowでの統合
7. イベントハンドリングの実装
8. テストとデバッグ
9. パッケージング
